(()=>{"use strict";const e="http://localhost:3001",t=t=>fetch(e+t).then((e=>{if(!e.ok)throw new Error("Ошибка получения  данных");return e.json()})),n=(t,n)=>fetch(e+t,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error("Ошибка получения  данных");return e.json()})),d=t=>fetch(e+t,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error("Ошибка получения  данных");return e.json()}));(()=>{const e=document.getElementById("category-name"),a=document.getElementById("category-image"),r=document.getElementById("category-add-btn"),o=document.getElementById("category-container"),i=document.getElementById("product-category"),c={name:"",preview:""},s=()=>{""===e.value||""===a?r.disabled=!0:r.disabled=!1},u=()=>{t("/categories").then((e=>{(e=>{o.innerHTML="",e.forEach(((e,t)=>{o.insertAdjacentHTML("beforeend",`\n                      <tr>\n                          <th scope="row">${t+1}</th>\n                          <td>${e.name}</td>\n                          <td class="text-end">\n                              <button type="button" class="btn btn-outline-danger btn-sm" data-category="${e.id}"> Удалить </button>\n                          </td>\n                      </tr>\n                  `),i.insertAdjacentHTML("beforeend",` \n                         <option value="${e.id}">${e.name}</option>\n                  `)}))})(e)}))};e.addEventListener("input",(()=>{c.name=e.value,s()})),a.addEventListener("input",(()=>{const e=a.files[0];if("image/png"===e.type||"image/jpeg"===e.type||"image/jpg"===e.type){const t=new FileReader;t.addEventListener("load",(()=>{c.preview=t.result})),t.addEventListener("error",(()=>{c.preview=""})),t.readAsDataURL(e)}else a.value="",a.value=""})),r.addEventListener("click",(()=>{n("/categories",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}}).then((t=>{e.value="",a.value="",u()}))})),o.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.category;d(`/categories/${t}`).then((e=>{u()}))}})),u(),s()})(),(()=>{const e=document.getElementById("product-name"),a=document.getElementById("product-image"),r=document.getElementById("product-title"),o=document.getElementById("product-price"),i=document.getElementById("product-add-btn"),c=document.getElementById("product-category"),s=document.getElementById("product-container"),u={name:"",preview:"",price:0,title:"",category:0},l=e=>{s.innerHTML="",e.forEach(((e,t)=>{s.insertAdjacentHTML("beforeend",`\n                        <tr>\n                              <th scope="row">${t+1}</th>\n                              <td>${e.title}</td>\n                              <td>${e.name}</td>\n                              <td>${e.price} ₽</td>\n                              <td class="text-end">\n                                    <button type="button" class="btn btn-outline-danger btn-sm" data-product="${e.id}"> Удалить </button>\n                              </td>\n                        </tr> \n                  `)}))},p=()=>{""===e.value||""===a||""===r||0===Number(o.value)||"default"===c.value?i.disabled=!0:i.disabled=!1};c.addEventListener("change",(()=>{u.category=c.value;const e="default"!==c.value?`/products?category=${c.value}`:"/products";t(e).then((e=>{console.log("data after filter ",e),l(e)})),p()})),e.addEventListener("input",(()=>{u.name=e.value,p()})),r.addEventListener("input",(()=>{u.title=r.value,p()})),o.addEventListener("input",(()=>{u.price=Number(o.value),p()})),a.addEventListener("input",(()=>{const e=a.files[0];if("image/png"===e.type||"image/jpeg"===e.type||"image/jpg"===e.type){const t=new FileReader;t.addEventListener("load",(()=>{u.preview=t.result})),t.addEventListener("error",(()=>{u.preview=""})),t.readAsDataURL(e)}else a.value=""}));const g=()=>{t("/products").then((e=>{l(e)}))};i.addEventListener("click",(()=>{n("/products",u).then((t=>{e.value="",a.value="",o.value="",r.value="",g()}))})),s.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.product;d(`/products/${t}`).then((e=>{g()}))}})),g(),p()})()})();