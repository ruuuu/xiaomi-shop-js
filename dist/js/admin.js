(()=>{"use strict";const e="http://localhost:3001",t=t=>fetch(e+t).then((e=>{if(!e.ok)throw new Error("Ошибка получения  данных");return e.json()})),n=(t,n)=>fetch(e+t,n).then((e=>{if(!e.ok)throw new Error("Ошибка получения  данных");return e.json()})),a=t=>fetch(e+t,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error("Ошибка получения  данных");return e.json()}));(()=>{const e=document.getElementById("category-name"),d=document.getElementById("category-image"),r=document.getElementById("category-add-btn"),o=document.getElementById("category-container"),i=document.getElementById("product-category"),c={name:"",preview:""},s=()=>{""===e.value||""===d?r.disabled=!0:r.disabled=!1},l=()=>{t("/categories").then((e=>{(e=>{o.innerHTML="",e.forEach(((e,t)=>{o.insertAdjacentHTML("beforeend",`\n                      <tr>\n                          <th scope="row">${t+1}</th>\n                          <td>${e.name}</td>\n                          <td class="text-end">\n                              <button type="button" class="btn btn-outline-danger btn-sm" data-category="${e.id}"> Удалить </button>\n                          </td>\n                      </tr>\n                  `),i.insertAdjacentHTML("beforeend",` \n                         <option value="${e.id}">${e.name}</option>\n                  `)}))})(e)}))};e.addEventListener("input",(()=>{c.name=e.value,s()})),d.addEventListener("input",(()=>{const e=d.files[0];if("image/png"===e.type||"image/jpeg"===e.type||"image/jpg"===e.type){const t=new FileReader;t.addEventListener("load",(()=>{c.preview=t.result})),t.addEventListener("error",(()=>{c.preview=""})),t.readAsDataURL(e)}else d.value="",d.value=""})),r.addEventListener("click",(()=>{n("/categories",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}}).then((t=>{e.value="",d.value="",l()}))})),o.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.category;a(`/categories/${t}`).then((e=>{l()}))}})),l(),s()})(),(()=>{const e=document.getElementById("product-name"),d=document.getElementById("product-image"),r=document.getElementById("product-title"),o=document.getElementById("product-price"),i=document.getElementById("product-add-btn"),c=document.getElementById("product-category"),s=document.getElementById("product-container"),l={name:"",preview:"",price:0,title:"",category:0},u=e=>{s.innerHTML="",e.forEach(((e,t)=>{s.insertAdjacentHTML("beforeend",`\n                        <tr>\n                              <th scope="row">${t+1}</th>\n                              <td>${e.title}</td>\n                              <td>${e.name}</td>\n                              <td>${e.price} ₽</td>\n                              <td class="text-end">\n                                    <button type="button" class="btn btn-outline-danger btn-sm" data-product="${e.id}"> Удалить </button>\n                              </td>\n                        </tr> \n                  `)}))},p=()=>{""===e.value||""===d||""===r||0===Number(o.value)||"default"===c.value?i.disabled=!0:i.disabled=!1};c.addEventListener("change",(()=>{l.category=c.value;const e="default"!==c.value?`/products?category=${c.value}`:"/products";t(e).then((e=>{console.log("data after filter ",e),u(e)})),p()})),e.addEventListener("input",(()=>{l.name=e.value,p()})),r.addEventListener("input",(()=>{l.title=r.value,p()})),o.addEventListener("input",(()=>{l.price=Number(o.value),p()})),d.addEventListener("input",(()=>{const e=d.files[0];if("image/png"===e.type||"image/jpeg"===e.type||"image/jpg"===e.type){const t=new FileReader;t.addEventListener("load",(()=>{l.preview=t.result})),t.addEventListener("error",(()=>{l.preview=""})),t.readAsDataURL(e)}else d.value=""}));const g=()=>{t("/products").then((e=>{console.log("data from updateTable ",e),u(e)}))};i.addEventListener("click",(()=>{console.log(l),n("/products",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}}).then((t=>{e.value="",d.value="",o.value="",r.value="",g()}))})),s.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.product;a(`/products/${t}`).then((e=>{g()}))}})),g(),p()})()})();