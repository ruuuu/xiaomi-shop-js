(()=>{"use strict";const t=t=>{const e=document.createElement("div");e.classList.add("modal-backdrop"),e.classList.add("fade"),document.body.append(e),setTimeout((()=>{e&&e.classList.add("show"),t.classList.add("show")}),100),t.classList.add("d-block"),setTimeout((()=>{t.classList.add("show")}),100)},e=t=>{const e=document.querySelector(".modal-backdrop");t.classList.remove("show"),e&&e.classList.remove("show"),setTimeout((()=>{t.style.display="none",e&&e.remove()}),500)},n="http://localhost:3001",o=t=>fetch(n+t).then((t=>{if(!t.ok)throw new Error("Ошибка получения  данных");return t.json()})),c=(t,e)=>fetch(n+t,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>{if(!t.ok)throw new Error("Ошибка получения  данных");return t.json()}));(()=>{const n=document.getElementById("open-auth-btn"),c=document.getElementById("auth-modal"),s=c.querySelectorAll(".close-btn"),a=c.querySelector(".login-btn"),r=document.getElementById("open-cart-btn"),d=document.getElementById("logout-btn"),l=()=>{n.classList.add("d-none"),r.classList.remove("d-none"),d.classList.remove("d-none"),e(c)};n.addEventListener("click",(()=>{t(c)})),s.forEach((t=>{t.addEventListener("click",(()=>{e(c)}))})),a.addEventListener("click",(()=>{const t=c.querySelector("#login-control"),e=c.querySelector("#password-control"),n={login:t.value,password:e.value};o("/profile").then((t=>{console.log(t),t.login===n.login&&t.password===n.password?(localStorage.setItem("auth",JSON.stringify(n)),l()):alert("неудасча")}))})),d.addEventListener("click",(()=>{localStorage.removeItem("auth"),n.classList.remove("d-none"),r.classList.add("d-none"),d.classList.add("d-none")})),(()=>{const t=JSON.parse(localStorage.getItem("auth"));t&&o("/profile").then((e=>{e.login===t.login&&e.password===t.password&&l()}))})()})(),(()=>{const t=document.getElementById("products-container");t.innerHTML="",t.addEventListener("click",(t=>{if(t.target.closest("button")){const e=t.target.closest("button").dataset.product;o(`/products/${e}`).then((t=>{var e;("/cart",e={name:t.name,count:1,price:t.price},fetch(n+"/cart",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>{if(!t.ok)throw new Error("Ошибка получения  данных");return t.json()}))).then((()=>{console.log("получили товар")}))})).catch((t=>{console.error("Произошла ошибка")}))}})),(()=>{const e=window.location.search,n=new URLSearchParams(e).get("id");o(n?`/products?category=${n}`:"/products").then((e=>{(e=>{console.log("data products",e),e.forEach((e=>{t.insertAdjacentHTML("beforeend",`    \n                        <div class="col col-12 col-sm-6 col-lg-4 col-xl-3 mb-3">\n                              <a href="#" class="card-link">\n                                    <div class="card">\n                                          <img src="${e.preview}" class="card-img-top" alt="phone-1">\n                                          <div class="card-body">\n                                                <span class="mb-2 d-block text-secondary">${e.title}</span>\n                                                <h6 class="card-title mb-3">${e.name}</h6>\n\n                                                <div class="row">\n                                                      <div class="col d-flex align-itemns-center justify-content-between">\n                                                      <h4>${e.price} ₽</h4>\n                                                      <button type="button" class="btn btn-outline-dark" data-product="${item.id}">\n                                                            <img src="/images/icon/shopping-cart-big.svg" alt="login">\n                                                      </button>\n                                                      </div>\n                                                </div>\n                                          </div>      \n                                    </div>\n                              </a>\n                        </div>\n                  `)}))})(e)})).catch((t=>{console.error("Произошла ошибка")}))})()})(),(()=>{const n=document.getElementById("cart-modal"),s=document.getElementById("open-cart-btn"),a=n.querySelectorAll(".close-btn"),r=document.getElementById(".cart-total-price"),d=document.getElementById("cart-container");d.innerHTML="";const l=()=>{o("/cart").then((t=>{(t=>{t.forEach((t=>{d.insertAdjacentHTML("beforeend",`\n                        <div class="row border-bottom pb-3 pt-3">\n                              <div class="col col-12 col-md-6 mb-3 mb-md-0 fs-4">${t.name}</div>\n                              <div class="col col-12 col-md-6 fs-4 d-flex align-items-center justify-content-end flex-wrap">\n                                    <h4 class="me-3 d-flex align-itemns-center">${t.price} ₽</h4>\n                                    <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                                          id="control-dec" data-id="${item.id}"  data-count="${item.count}">\n                                          -\n                                    </button>\n                                    <h6 class="cart-item-count me-3 ms-3">${t.count}</h6>\n                                    <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls"\n                                          id="control-inc" data-id="${item.id}"  data-count="${item.count}">\n                                          +\n                                    </button>\n                              </div>\n                        </div>\n                  `)}))})(t),i(t)})).catch((t=>{console.error("Произошла ошибка")}))},i=t=>{let e=0;t.forEach((t=>{e+=Number(t.count)*Number(t.price)})),r.textContent=e};s.addEventListener("click",(()=>{l(),t(n)})),a.forEach((t=>{t.addEventListener("click",(()=>{e(n)}))})),d.addEventListener("click",(t=>{if(t.target.closest("button"))if(t.target.id&&"control-inc"===t.target.id){const e=t.target.dataset.id,n=Number(t.target.dataset.count);c(`/cart/${e}`,{count:n+1}).then((()=>{l()}))}else if(t.target.id&&"control-dec"===t.target.id){const e=t.target.dataset.id,n=t.target.dataset.count;n>0&&c(`/cart/${e}`,{count:n-1}).then((()=>{l()}))}}))})()})();